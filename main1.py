import sqlite3
from unittest.mock import call

import telebot
from pyexpat.errors import messages
from telebot import types


bot = telebot.TeleBot('')

user_data = {}
gift_suggestions = {
    (range(0, 13), '–ú—É–∂—Å–∫–æ–π', '–ù–æ–≤—ã–π –≥–æ–¥'): ['–º–∞—à–∏–Ω–∫–∞ Lego - 261094316, \n–Ω–∞–±–æ—Ä "–°–æ–∑–¥–∞–π —Å–≤–æ–π —Å–ª–∞–π–º" - 14130888, \n–ø–∏–∂–∞–º–∞ - 263600517, \n–∞–∫–≤–∞—Ä–∏—É–º –¥–ª—è —Ä—ã–±–æ–∫ - 218649828'],
    (range(0, 13), '–ñ–µ–Ω—Å–∫–∏–π', '–ù–æ–≤—ã–π –≥–æ–¥'): ['—Ü–≤–µ—Ç–æ—á–Ω–∞—è –æ—Ä–∞–Ω–∂–µ—Ä–µ—è - 195905714,\n–ø–∏–∂–∞–º–∞ - 181129796,\n–ø–∞—Ä—Ñ—é–º - 86957538,\n–æ—Ä–≥–∞–Ω–∞–π–∑–µ—Ä - 228183998, \n–º—è–≥–∫–∞—è –∏–≥—Ä—É—à–∫–∞ - 225761747'],
    (range(13, 18), '–ú—É–∂—Å–∫–æ–π', '–ù–æ–≤—ã–π –≥–æ–¥'): ['—Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ—Å—Ç—é–º - 167953664, \n–±—É—Ç—ã–ª–∫–∞ –¥–ª—è —Å–ø–æ—Ä—Ç–∏–≤–Ω–æ–≥–æ –ø–∏—Ç–∞–Ω–∏—è - 174479122,\n–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π - 10554940,\n–Ω–∞—É—à–Ω–∏–∫–∏ - 196598251'],
    (range(13, 18), '–ñ–µ–Ω—Å–∫–∏–π', '–ù–æ–≤—ã–π –≥–æ–¥'): ['–∫–æ—Å–º–µ—Ç–∏—á–∫–∞ - 187559583,\n–∫—Ä—É–∂–∫–∞ - 248358095,\n—Å—É–º–∫–∞ - 140303471,\n–º–∞—Å—Å–∞–∂–Ω—ã–π –Ω–∞–±–æ—Ä - 109819627,\n–∫–∞—Ä—Ç–∏–Ω–∞ –ø–æ –Ω–æ–º–µ—Ä–∞–º - 171788009,\n–Ω–∞–±–æ—Ä the act - 18165016,\n—Ç–∞–ø–æ—á–∫–∏ - 247674900'],
    (range(18, 100), '–ú—É–∂—Å–∫–æ–π', '–ù–æ–≤—ã–π –≥–æ–¥'): ['–∫–æ—à–µ–ª–µ–∫ - –∫–æ—à–µ–ª–µ–∫,\n—Å—É–º–∫–∞ –∫–æ–∂–∞–Ω–∞—è -153586243,\n —ç–ª–µ–∫—Ç—Ä–æ–±—Ä–∏—Ç–≤–∞ - 236253622,\n—á–∞—Å—ã - 197625996,\n–ø—ã–ª–µ—Å–æ—Å –≤ –º–∞—à–∏–Ω—É - 269977708'],
    (range(18, 100), '–ñ–µ–Ω—Å–∫–∏–π', '–ù–æ–≤—ã–π –≥–æ–¥'): ['—á–∞—Å—ã - 265669618,\n–∫–æ—à–µ–ª–µ–∫	- 234913969,\n—Å–≤–µ—á–∏ - 216358665,\n—Ñ–µ–Ω	- 139263450,\n–ø–∞—Ä—Ñ—é–º - 208840395,\n–ø–æ—Å—Ç–µ–ª—å–Ω–æ–µ –±–µ–ª—å–µ - 177238479,\n–±–æ–∫–∞–ª—ã - 264670867'],
    (range(0, 13), '–ú—É–∂—Å–∫–æ–π', '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'): ['–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä LEGO', '–ú–∞—à–∏–Ω–∫–∞ –Ω–∞ –ø—É–ª—å—Ç–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è'],
    (range(0, 13), '–ñ–µ–Ω—Å–∫–∏–π', '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'): ['–ù–∞–±–æ—Ä –¥–ª—è —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞', '–ú—è–≥–∫–∞—è –∏–≥—Ä—É—à–∫–∞'],
    (range(13, 18), '–ú—É–∂—Å–∫–æ–π', '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'): ['–ò–≥—Ä–æ–≤–∞—è –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞', '–ö–Ω–∏–≥–∞ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π'],
    (range(13, 18), '–ñ–µ–Ω—Å–∫–∏–π', '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'): ['–ë–ª–æ–∫–Ω–æ—Ç —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –¥–∏–∑–∞–π–Ω–æ–º', '–£–∫—Ä–∞—à–µ–Ω–∏–µ –¥–ª—è –≤–æ–ª–æ—Å'],
    (range(18, 100), '–ú—É–∂—Å–∫–æ–π', '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'): ['–£–º–Ω—ã–µ —á–∞—Å—ã', '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –∫–Ω–∏–≥–∞'],
    (range(18, 100), '–ñ–µ–Ω—Å–∫–∏–π', '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è'): ['–î—É—Ö–∏', '–ù–∞–±–æ—Ä –¥–ª—è —É—Ö–æ–¥–∞ –∑–∞ –∫–æ–∂–µ–π'],
    (range(18, 100), '–ú—É–∂—Å–∫–æ–π', '–î–µ–Ω—å –û—Ç—Ü–∞'): ['–ú—É–∂—Å–∫–æ–π –ø–∞—Ä—Ñ—é–º', '–ö–æ–∂–∞–Ω—ã–π –∫–æ—à–µ–ª—ë–∫'],
    (range(18, 100), '–ñ–µ–Ω—Å–∫–∏–π', '–î–µ–Ω—å –ú–∞—Ç–µ—Ä–∏'): ['–ë—É–∫–µ—Ç —Ü–≤–µ—Ç–æ–≤', '–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–∞ SPA'],
    (range(13, 18), '–ú—É–∂—Å–∫–æ–π', '14 —Ñ–µ–≤—Ä–∞–ª—è'): ['–®–æ–∫–æ–ª–∞–¥–Ω—ã–π –Ω–∞–±–æ—Ä', '–§—É—Ç–±–æ–ª–∫–∞ —Å —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø—Ä–∏–Ω—Ç–æ–º'],
    (range(13, 18), '–ñ–µ–Ω—Å–∫–∏–π', '14 —Ñ–µ–≤—Ä–∞–ª—è'): ['–®–æ–∫–æ–ª–∞–¥–Ω—ã–π –Ω–∞–±–æ—Ä', '–ü–æ–¥–≤–µ—Å–∫–∞ –≤ —Ñ–æ—Ä–º–µ —Å–µ—Ä–¥—Ü–∞'],
    (range(18, 100), '–ú—É–∂—Å–∫–æ–π', '14 —Ñ–µ–≤—Ä–∞–ª—è'): ['–ë–∏–ª–µ—Ç –Ω–∞ —Å–æ–≤–º–µ—Å—Ç–Ω—ã–π –∫–æ–Ω—Ü–µ—Ä—Ç', '–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω'],
    (range(18, 100), '–ñ–µ–Ω—Å–∫–∏–π', '14 —Ñ–µ–≤—Ä–∞–ª—è'): ['–Æ–≤–µ–ª–∏—Ä–Ω–æ–µ —É–∫—Ä–∞—à–µ–Ω–∏–µ', '–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω'],
    (range(13, 18), '–ú—É–∂—Å–∫–æ–π', '23 —Ñ–µ–≤—Ä–∞–ª—è'): ['–ê—Ä–º–µ–π—Å–∫–∏–π –±—Ä–∞—Å–ª–µ—Ç', '–§—É—Ç–±–æ–ª–∫–∞ —Å –≤–æ–µ–Ω–Ω–æ–π —Å–∏–º–≤–æ–ª–∏–∫–æ–π'],
    (range(18, 100), '–ú—É–∂—Å–∫–æ–π', '23 —Ñ–µ–≤—Ä–∞–ª—è'): [''],
    (range(0, 13), '–ñ–µ–Ω—Å–∫–∏–π', '8 –º–∞—Ä—Ç–∞'): ['–î–µ—Ç—Å–∫–∏–π —Å—É–ø–µ—Ä–º–∞—Ä–∫–µ—Ç - 169855582,\n–ù–æ—á–Ω–∏–∫ - 255606546,\n–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π –±–æ–∫—Å –µ–¥–∏–Ω–æ—Ä–æ–≥ - 267375416,\n–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π –Ω–∞–±–æ—Ä –º–∞—Å–æ–∫ - 251918531,'
                                            '\n–ù–∞–±–æ—Ä —Å–ª–∞–π–º–æ–≤ - 28872234,\n–ü–æ–≥—Ä–µ–º—É—à–∫–∞ –ø–æ–¥–≤–µ—Å–∫–∞ - 65144411,\n–ú–æ–±–∏–ª—å –≤ –∫—Ä–æ–≤–∞—Ç–∫—É - 138981683,\n–ò–≥—Ä—É—à–∫–∞ –¥–ª—è —Å–Ω–∞ - 243900305,'
                                            '\n–ü–∏–∂–∞–º–∞ 7 –≤ 1	- 215337226,\n 3 –¥ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä - 220735250,\n–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä "–ö–∞—Ä–µ—Ç–∞ –ü—Ä–∏–Ω—Ü–µ—Å—Å—ã"	- 269290279,\n–ó–∞–º–æ–∫ –•–æ–≥–≤–∞—Ä—Ç—Å - 223339960,'
                                            '\n–ú–µ—Ö–æ–≤–∞—è —Å—É–º–∫–∞ - 189799266,\n–°—É–º–∫–∞ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–æ–π –ø—Ä–∏–Ω—Ü–µ—Å—Å—ã - 211541929,\n–°—É–º–∫–∞ —á–µ—Ä–µ–∑ –ø–ª–µ—á–æ - 188892713'],
    (range(13, 18), '–ñ–µ–Ω—Å–∫–∏–π', '8 –º–∞—Ä—Ç–∞'): ['–ö–Ω–∏–≥–∞ "–≠—Ç–æ–º—É –Ω–µ —É—á–∞—Ç –≤ —à–∫–æ–ª–µ" - 243462186,\n–ü–∞–ª–µ—Ç–∫–∞ —Ç–µ–Ω–µ–π - 227871550,\n–ñ–∏–≤–∞—è —Ä–æ–∑–∞ –≤ –∫–æ–ª–±–µ —Å —É–∫—Ä–∞—à–µ–Ω–∏–µ–º - 170739275,'
                                            '\n–ù–∞–±–æ—Ä –∫–æ—Å–º–µ—Ç–∏–∫–∏ –¥–ª—è –º–∞–∫–∏—è–∂–∞ - 248681119,\n–ö–∞—Ä—Ç–∏–Ω–∞ –ø–æ –Ω–æ–º–µ—Ä–∞–º - 230801145,\n3 –¥ —Å—Ç–∏–∫–µ—Ä—ã –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω - 223207794,\n–ö–∏—Å—Ç–∏ –¥–ª—è –º–∞–∫–∏—è–∂–∞ - 180790342,'
                                            '\n–§—É—Ç–±–æ–ª–∫–∞ —Å –ø—Ä–∏–Ω—Ç–æ–º - 247897839,\n–°–∫—Ä–∞–± –¥–ª—è —Ç–µ–ª–∞ - 18165016,\n–®—ë–ª–∫–æ–≤–∞—è –ø–∏–∂–∞–º–∞ 7 –≤ 1	- 150989309,'
                                            '\n–°—É–º–∫–∞ —á–µ—Ä–µ–∑ –ø–ª–µ—á–æ - 249399126,\n–°—É–º–∫–∞ –±–µ–ª–∞—è - 251241569,\n–ö–æ—Å–º–µ—Ç–∏—á–∫–∞ - 222877932,\n–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ—Å—Ç—é–º - 206483166'
                                            '\n–ú–∞–≥–Ω–∏—Ç–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ - 246477766,\n–ù–∞–±–æ—Ä –¥–ª—è –º–∞–Ω–∏–∫—é—Ä–∞ 70 –≤ 1 - 116112872,\n–ù–∞–±–æ—Ä –∫—Ä–µ–º–æ–≤ –¥–ª—è —Ä—É–∫ - 124737470,\n'
                                            'Beauty box	- 204506781,\n–ê–¥–≤–µ–Ω—Ç –∫–∞–ª–µ–Ω–¥–∞—Ä—å —Å –∫–æ—Å–º–µ—Ç–∏–∫–æ–π - 264347880,\n–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–∞ –ø—É–ª—å—Ç–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - 248380682'],
    (range(18, 100), '–ñ–µ–Ω—Å–∫–∏–π', '8 –º–∞—Ä—Ç–∞'): ['–ù–∞–±–æ—Ä —á–∞—à–µ–∫ - 277349587,\n–ù–∞–±–æ—Ä –∫—É—Ö–æ–Ω–Ω—ã—Ö –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–µ–π - 225906007,\n–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è –º–∞—Å—Å–∞–∂–∞ –ª–∏—Ü–∞ - 119495900,'
                                             '\n–ü–æ–¥–∞—Ä–æ—á–Ω—ã–π –Ω–∞–±–æ—Ä —É—Ö–æ–¥–æ–≤–æ–π –∫–æ—Å–º–µ—Ç–∏–∫–∏ - 203883139,\n–¢–∞—Ä–µ–ª–∫–∏ –≤ –≤–∏–¥–µ –±—É—Ç—ã–ª–æ–∫ - 156660173,\n–ù–∞–±–æ—Ä –∫—É—Ö–æ–Ω–Ω—ã—Ö –ø–æ–ª–æ—Ç–µ–Ω–µ—Ü - 237976737,'
                                             '\n–•–∞–ª–∞—Ç —à–µ–ª–∫–æ–≤—ã–π - 172744486, \n–•–∞–ª–∞—Ç –º–∞—Ö—Ä–æ–≤—ã–π - 192850169,\n–î–∏—Ñ—Ñ—É–∑–æ—Ä - 17669172,\n–ü–∏–∂–∞–º–∞ - 266191151']
}

@bot.message_handler(commands=['start'])
def start(message):
    user_data[message.chat.id] = {}
    bot.send_message(message.chat.id, '–ü—Ä–∏–≤–µ—Ç, —è - –ë–æ—Ç,–∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –≤—ã–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–∫–∏ –Ω–∞ –ª—é–±–æ–π –ø–æ–≤–æ–¥! –î–ª—è –Ω–∞—á–∞–ª–∞ —É–∫–∞–∂–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä–æ–º—É –±—É–¥–µ–º –ø–æ–¥–±–∏—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫')
    bot.register_next_step_handler(message, get_age)

def get_age(message):
    if not message.text.isdigit():
        if message.text.startswith('/'):
            bot.send_message(message.chat.id, '–í—ã –≤–≤–µ–ª–∏ –∫–æ–º–∞–Ω–¥—É –≤–º–µ—Å—Ç–æ –≤–æ–∑—Ä–∞—Å—Ç–∞. –î–∞–≤–∞–π—Ç–µ –Ω–∞—á–Ω—ë–º –∑–∞–Ω–æ–≤–æ.')
            start(message)
            return
        bot.send_message(message.chat.id, '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–æ–∑—Ä–∞—Å—Ç —á–∏—Å–ª–æ–º.')
        bot.register_next_step_handler(message, get_age)
        return
    if message.chat.id not in user_data:
        user_data[message.chat.id] = {}
    user_data[message.chat.id]['age'] = int(message.text)
    sex = types.InlineKeyboardMarkup()
    btn_male = types.InlineKeyboardButton('–ú—É–∂—Å–∫–æ–π', callback_data='male')
    btn_female = types.InlineKeyboardButton('–ñ–µ–Ω—Å–∫–∏–π', callback_data='female')
    sex.row(btn_male, btn_female)
    bot.send_message(message.chat.id, '–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª —á–µ–ª–æ–≤–µ–∫–∞:', reply_markup=sex)

@bot.callback_query_handler(func=lambda call: call.data in ['male', 'female'])
def get_gender(call):
    gender = '–ú—É–∂—Å–∫–æ–π' if call.data == 'male' else '–ñ–µ–Ω—Å–∫–∏–π'
    user_data[call.message.chat.id]['gender'] = gender
    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton('–ü–æ–¥–∞—Ä–∫–∏ –∫–æ –î–Ω—é –†–æ–∂–¥–µ–Ω–∏—è', callback_data='birthday_gifts'))
    markup.add(types.InlineKeyboardButton('–ü–æ–¥–∞—Ä–∫–∏ –∫ –ù–æ–≤–æ–º—É –ì–æ–¥—É', callback_data='new_year_gifts'))
    markup.add(types.InlineKeyboardButton('–ü–æ–¥–∞—Ä–∫–∏ –Ω–∞ 14 —Ñ–µ–≤—Ä–∞–ª—è', callback_data='14_february_gifts'))
    markup.add(types.InlineKeyboardButton('–ü–æ–¥–∞—Ä–∫–∏ –∫ 23 —Ñ–µ–≤—Ä–∞–ª—è', callback_data='23_february_gifts'))
    markup.add(types.InlineKeyboardButton('–ü–æ–¥–∞—Ä–∫–∏ –∫ 8 –º–∞—Ä—Ç–∞', callback_data='8_march_gifts'))
    markup.add(types.InlineKeyboardButton('–ü–æ–¥–∞—Ä–∫–∏ –∫–æ –î–Ω—é –ú–∞—Ç–µ—Ä–∏', callback_data='mothers_day_gifts'))
    markup.add(types.InlineKeyboardButton('–ü–æ–¥–∞—Ä–∫–∏ –∫–æ –î–Ω—é –û—Ç—Ü–∞', callback_data='fathers_day_gifts'))
    bot.send_message(call.message.chat.id, '–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö', reply_markup=markup)


@bot.callback_query_handler(func=lambda call: call.data in ['birthday_gifts','new_year_gifts','14_february_gifts','23_february_gifts','8_march_gifts','mothers_day_gifts', 'fathers_day_gifts'])
def get_occasion(call):
    occasion_list = {
        'birthday_gifts': '–î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è',
        'new_year_gifts': '–ù–æ–≤—ã–π –≥–æ–¥',
        'mothers_day_gifts': '–î–µ–Ω—å –ú–∞—Ç–µ—Ä–∏',
        'fathers_day_gifts': '–î–µ–Ω—å –û—Ç—Ü–∞',
        '14_february_gifts': '14 —Ñ–µ–≤—Ä–∞–ª—è',
        '23_february_gifts': '23 —Ñ–µ–≤—Ä–∞–ª—è',
        '8_march_gifts': '8 –º–∞—Ä—Ç–∞'
    }
    occasion = occasion_list.get(call.data, '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π')
    if call.message.chat.id in user_data:
        user_data[call.message.chat.id]['occasion'] = occasion
    else:
        user_data[call.message.chat.id] = {'occasion': occasion}
    user = user_data.get(call.message.chat.id)
    if not user or 'age' not in user or 'gender' not in user or 'occasion' not in user:
        bot.send_message(call.message.chat.id, '–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ–ø–æ–ª–Ω—ã–µ. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ.')
        start(call.message)
        return
    start_button = types.InlineKeyboardMarkup()
    start_button.add(types.InlineKeyboardButton('–ü–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫', callback_data='choose_gift'))
    bot.send_message(call.message.chat.id, f"–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! –í–æ–∑—Ä–∞—Å—Ç: {user_data[call.message.chat.id]['age']}, –ü–æ–ª: {user_data[call.message.chat.id]['gender']}, –ü—Ä–∞–∑–¥–Ω–∏–∫: {user_data[call.message.chat.id]['occasion']}. –ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–æ–¥–∞—Ä–æ–∫", reply_markup=start_button)

@bot.callback_query_handler(func=lambda call: call.data == 'choose_gift')
def choose_gift(call):
    user = user_data.get(call.message.chat.id)
    if 'occasion' not in user:
        bot.send_message(call.message.chat.id, '–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç ')
    elif 'age' not in user:
        bot.send_message(call.message.chat.id, '–í–æ–∑—Ä–∞—Å—Ç –Ω–µ –≤–≤–µ–¥–µ–Ω –∏–ª–∏ –≤–≤–µ–¥–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ')
    elif 'gender' not in user:
        bot.send_message(call.message.chat.id, '–ü–æ–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –≤–≤–µ–¥–µ–Ω –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ')
        start(call.message)
        return
    matching_gifts = []
    for (age_range, gift_gender, gift_holiday), gifts in gift_suggestions.items():
        if int(user['age']) in age_range and user['gender'] == gift_gender and user['occasion'] == gift_holiday:
            matching_gifts.extend(gifts)

    if matching_gifts:
        bot.send_message(call.message.chat.id, f"–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–æ–¥–∞—Ä–∫–∏: {', '.join(matching_gifts)}")
    else:
         bot.send_message(call.message.chat.id, "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –ø–æ–¥–∞—Ä–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
    restart_markup = types.InlineKeyboardMarkup()
    restart_markup.add(types.InlineKeyboardButton('–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ', callback_data = 'restart'))
    restart_markup.add(types.InlineKeyboardButton('–ó–∞–∫–æ–Ω—á–∏—Ç—å', callback_data = 'end'))
    bot.send_message(call.message.chat.id,"–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:",reply_markup=restart_markup)

@bot.callback_query_handler(func=lambda call: call.data == 'restart')
def restart(call):
    bot.send_message(call.message.chat.id, '–•–æ—Ä–æ—à–æ, –Ω–∞—á–Ω—ë–º —Å–Ω–∞—á–∞–ª–∞!')
    start(call.message)  # –í—ã–∑—ã–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start

@bot.callback_query_handler(func=lambda call: call.data == 'end')
def end(call):
    bot.send_message(call.message.chat.id, '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–∞—à–∏–º –±–æ—Ç–æ–º! üòä')

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bot.polling()
